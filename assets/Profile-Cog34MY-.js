import{b as D,a as L,r as n,j as e,B as l,F as U,c as T,s as B,t as R,S as q,v as H,w as V,x as W,C as G,N as F}from"./index-Dqm4jMKV.js";import{F as E}from"./Form-CAKH7Ctb.js";import{C as v,a as I}from"./Col-BOHIMIKG.js";import{T as $}from"./Table-q5IseJE7.js";import{P as M,R as _}from"./Row-DqDFZvuJ.js";function J(){const y=D(),{user:r,setUser:c,logout:S}=L(),[f,h]=n.useState(null),[d,u]=n.useState(!1),[x,i]=n.useState(!1),[o,m]=n.useState(""),N=async t=>{!r||d||t==="password"||(h(t),m(String(r[t]??"")))},w=async()=>{f===null&&(u(!0),m(""))},g=async t=>{const j=o.trim();if(!j)return;const C={[t]:j},b=B(C);if(console.log(b),b!=null&&r!=null){const P={...r,[t]:j};c(P)}t==="password"?(u(!1),i(!1)):h(null),m("")},k=()=>{!window.confirm("¿Estás seguro de que deseas eliminar tu cuenta? Esta acción es irreversible.")||!R()||(S(),y("/"))},O=t=>new Date(t).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"});return r?e.jsxs("div",{className:"p-4 border rounded bg-light w-100",children:[e.jsx("h4",{className:"mb-4",children:"Información del Perfil"}),[["username","Nombre de usuario"],["fullname","Nombre completo"],["email","Correo electrónico"]].map(([t,j])=>e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:j}),f===t?e.jsxs(e.Fragment,{children:[e.jsx(E.Control,{type:"text",className:"mt-1 w-auto",style:{minWidth:"250px"},value:o,onChange:C=>m(C.target.value)}),e.jsxs("div",{className:"mt-2",children:[e.jsx(l,{variant:"success",size:"sm",onClick:()=>g(t),children:"Guardar"})," ",e.jsx(l,{variant:"secondary",size:"sm",onClick:()=>h(null),children:"Cancelar"})]})]}):e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-1",children:[e.jsx("span",{children:r[t]}),e.jsx(l,{variant:"outline-primary",size:"sm",onClick:()=>N(t),disabled:d,children:"Editar"})]})]},t)),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Contraseña"}),d?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-1 input-group",style:{maxWidth:"300px"},children:[e.jsx(E.Control,{type:x?"text":"password",className:"w-auto",style:{minWidth:"250px"},value:o,onChange:t=>m(t.target.value)}),e.jsx(l,{variant:"outline-secondary",onClick:()=>i(t=>!t),children:x?e.jsx(U,{}):e.jsx(T,{})})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx(l,{variant:"success",size:"sm",onClick:()=>{g("password"),u(!1)},children:"Guardar"})," ",e.jsx(l,{variant:"secondary",size:"sm",onClick:()=>{u(!1)},children:"Cancelar"})]})]}):e.jsx("div",{className:"d-flex justify-content-between align-items-center mt-1",children:e.jsx(l,{variant:"outline-warning",size:"sm",onClick:w,disabled:f!==null,children:"Cambiar contraseña"})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{children:e.jsx("strong",{children:"Eliminar mi cuenta"})}),e.jsx("div",{className:"mt-2 d-flex justify-content-end",children:e.jsx(l,{variant:"danger",size:"sm",onClick:k,children:"Eliminar cuenta"})})]}),e.jsx("div",{className:"mt-4 text-muted",children:e.jsxs("small",{children:["Unido desde: ",O(r.createdAt)]})})]}):e.jsx("div",{children:"Cargando usuario..."})}const z={1:"Registrado",2:"Cocinando",3:"Entregando",4:"Entregada"};function K(){const[y,r]=n.useState([]),[c,S]=n.useState(null),[f,h]=n.useState(null),[d,u]=n.useState(),[x,i]=n.useState(1),[o,m]=n.useState(10),[N,w]=n.useState(0),[g,k]=n.useState(0),[O,t]=n.useState(!1),j=async()=>{t(!0);const{totalItems:s,orders:a}=await H(x,o,d);r(a),w(s),t(!1)},C=async s=>{const a=await V(s);a&&(S(a),h(s))};n.useEffect(()=>{j(),k(Math.ceil(N/o))},[x,o,d]);const b=s=>{m(Number(s.target.value)),i(1)},P=s=>{const a=Number(s.target.value);u(isNaN(a)?void 0:a),i(1)},A=async s=>{if(window.confirm("¿Estás seguro de que deseas eliminar esta orden?"))try{await W(s),r(y.filter(p=>p.id!==s))}catch{alert("Error al eliminar el producto.")}};return e.jsx(v,{className:"mb-4",children:e.jsxs(v.Body,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h4",{className:"mb-0",children:"Mis Ordenes"}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs(E.Select,{value:d??"",onChange:P,style:{width:150},children:[e.jsx("option",{value:"",children:"Todos"}),Object.entries(z).map(([s,a])=>e.jsx("option",{value:s,children:a},s))]}),e.jsxs(E.Select,{value:o,onChange:b,style:{width:150},children:[e.jsx("option",{value:5,children:"5 por página"}),e.jsx("option",{value:10,children:"10 por página"}),e.jsx("option",{value:20,children:"20 por página"})]})]})]}),O?e.jsx("div",{className:"text-center py-4",children:e.jsx(q,{animation:"border"})}):e.jsxs($,{bordered:!0,hover:!0,responsive:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Fecha"}),e.jsx("th",{children:"Productos"}),e.jsx("th",{children:"Total"}),e.jsx("th",{children:"Estado"}),e.jsx("th",{children:"Acciones"})]})}),e.jsx("tbody",{children:y.map(s=>{const a=f===s.id;return e.jsx(n.Fragment,{children:e.jsxs("tr",{children:[e.jsx("td",{children:s.id}),e.jsx("td",{children:new Date(s.createdAt).toLocaleString()}),e.jsx("td",{children:a&&(c==null?void 0:c.id)===s.id&&e.jsx("ul",{className:"mb-0",children:c.items.map(p=>e.jsxs("li",{children:[p.productName," x ",p.quantity," - $",p.price.toFixed(2)]},p.id))})}),e.jsxs("td",{children:["$",s.totalPrice.toFixed(2)]}),e.jsx("td",{children:z[s.state]}),e.jsx("td",{children:e.jsxs(e.Fragment,{children:[e.jsx(l,{size:"sm",variant:"info",onClick:()=>a?h(null):C(s.id),children:a?"Ocultar":"Ver Detalles"}),s.state===1&&e.jsx(l,{size:"sm",variant:"danger",className:"ms-2",onClick:()=>A(s.id),children:"Eliminar"})]})})]})},s.id)})})]}),g>1&&e.jsx(M,{children:Array.from({length:g},(s,a)=>e.jsx(M.Item,{active:a+1===x,onClick:()=>i(a+1),children:a+1},a+1))})]})})}function se(){const y=D(),{user:r,role:c,logout:S}=L(),[f,h]=n.useState(!1),[d,u]=n.useState(!0),[x,i]=n.useState(!1),o=[u,i];n.useEffect(()=>{c!=null&&c.default?(h(!0),i(!1)):(h(!1),i(!0))},[]);const m=w=>{for(const g of o)g(!1);w(!0)},N=()=>{S(),y("/")};return r?e.jsx(G,{fluid:!0,className:"my-4",children:e.jsxs(_,{children:[e.jsx(I,{md:3,children:e.jsxs(v,{className:"position-sticky top-0",style:{minHeight:"100vh"},children:[e.jsx(v.Header,{className:"bg-primary text-white",children:"Mi Perfil"}),e.jsxs(v.Body,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("strong",{children:["Nombre Completo: ",r.fullname]}),e.jsx("br",{}),e.jsxs("small",{className:"text-muted",children:["Usuario: @",r.username]}),e.jsx("br",{}),e.jsxs("small",{children:["Correo: ",r.email]})]}),e.jsxs(F,{className:"flex-column mb-3",children:[f&&e.jsx(F.Link,{onClick:()=>m(u),className:d?"text-primary fw-bold":"text-dark",children:"Mis Ordenes"}),e.jsx(F.Link,{onClick:()=>m(i),className:x?"text-primary fw-bold":"text-dark",children:"Mi Perfil"})]}),e.jsx(l,{variant:"danger",onClick:N,className:"w-100",children:"Cerrar sesión"})]})]})}),e.jsxs(I,{md:9,children:[d&&f&&e.jsx(K,{}),x&&e.jsx(J,{})]})]})}):e.jsx(v,{className:"position-sticky top-0",style:{minHeight:"100vh"},children:e.jsx(v.Body,{children:e.jsx("p",{className:"text-center text-muted",children:"Cargando perfil..."})})})}export{se as default};
